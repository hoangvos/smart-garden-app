<%- include('includes/head.ejs') %>
    <link rel="stylesheet" type="text/css" href="/css/style.css">
</head>
<body>
    <style>
        @media (max-width: 40em) {
            .data{
                display: block;
                justify-items: center;
            }
        }
    </style>
    <%- include('includes/navigation.ejs') %>

    <div class="container">
        <header class="main_header">
            <h1 class="IOT_h1">IOT Garden</h1>
        </header>
        <% if (isAuthenticated) { %>
            <div class="data">
                <div class="data-item" id='div-temp' onclick="applyClickEffect_temp();window.location='/chart-temperature';" style="display: flex;width: 100%;  ;
                transition: all 0.3s;"
                onmouseover="this.style.backgroundColor='rgb(234, 127, 127)'; this.style.border='1px solid green';" onmouseout="this.style.backgroundColor='#f0f0f0'; this.style.border='1px solid transparent';" 
                ;>
                    <div class="icon-big icon-danger text-center" style="width: 100%; height: 150px;justify-content: center; align-items: center;">
                        <i class="fas fa-temperature-high" style="font-size: 125px; padding-top: 10px; color: rgb(194, 56, 56);"></i>
                    </div>
                    
                    <div style="width: 100%">
                    <p class="data-label" style="font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif; justify-content: center; align-items: center; padding-top: 25px;">Temperature</p>
                    <p class="data-value" style="padding-top: 10px;"><span id="temperature" style="padding-top: 40px;"><%= temperature %>°C</span></p>
                    </div>
                </div>

                <div class="data-item" id='div-hum' onclick="applyClickEffect_hum();window.location='/chart-humidity';" style="display: flex;width: 100%; ;
                transition: all 0.3s;"
                onmouseover="this.style.backgroundColor='rgb(9, 114, 140)'; this.style.border='1px solid green';" onmouseout="this.style.backgroundColor='#f0f0f0'; this.style.border='1px solid transparent';">

                    <div class="icon-big icon-info text-center" style="width: 100%; height: 150px;justify-content: center; align-items: center;">
                        <i class="fas fa-tint" style="font-size: 125px; padding-top: 10px; color: rgb(0, 204, 255)"></i>
                    </div>
                    <div style="width: 100%">
                        <p class="data-label" style="font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif; justify-content: center; align-items: center; padding-top: 25px;">Humidity</p>
                        <p class="data-value" style="padding-top: 10px;"><span id="humidity" style="padding-top: 40px;"><%= humidity %>%</span></p>
                    </div>
                </div>
            </div>
            <div class="data">
                <div class="data-item" onclick="applyClickEffect_temp();window.location='/chart-brightness';" style="display: flex;width: 100%;
                transition: all 0.3s;
                "
                onmouseover="this.style.backgroundColor='rgb(211, 227, 109)'; this.style.border='1px solid green';" onmouseout="this.style.backgroundColor='#f0f0f0'; this.style.border='1px solid transparent';" 
                ;>
                    <div class="icon-big icon-danger text-center" style="width: 100%; height: 150px;justify-content: center; align-items: center;">
                        <i class="fas fa-lightbulb" style="font-size: 125px; padding-top: 10px; color: rgb(224, 248, 7);"></i>
                    </div>
                    <div style="width: 100%">
                    <p class="data-label" style="font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif; justify-content: center; align-items: center; padding-top: 25px;">Brightness Level</p>
                    <p class="data-value" style="padding-top: 10px;"><span id="brightness" style="padding-top: 40px;"><%= brightness %> Lux</span></p>
                    </div>
                </div>  
                <div class="data-item" style="width: 100%; padding: 30px;">
                    <div class="data-item"
                     style="width: 100%;
                    display: flex;  height: 100px;">
                        <div onclick="window.location='/history-door';"
                        style="display: flex; border-radius: 5px;
                        transition: all 0.3s;"
                        onmouseover="this.style.backgroundColor='orange'; this.style.border='1px solid green';" onmouseout="this.style.   backgroundColor='#f0f0f0'; this.style.border='1px solid transparent';"
                        class="icon-big icon-info text-center" style="width: 75px; height: 50px;justify-content: center; align-items: center; padding-bottom: 10px;justify-content: center; align-items: center;margin-right: 20px ;">
                            <i class="fas fa-door-open" style="font-size: 75px; margin-bottom: 10px; color: gray"></i>
                        </div>
                        <div style="display: flex; justify-content:center; align-items: center; margin-left: 10px;">
                            <p style="font-size: 25px; font-weight: bold;">Door</p>
                        </div>

                        <label class="switch" style="margin-left: auto;">
                            <input type="checkbox" id="door-toggle" <%= door ? 'checked' : '' %>>
                            <span id="door-toggle-id" class="slider round"> </span>
                        </label>

                    </div>
                    <div class="data-item" style="display: flex; width: 100%; ">
                        <div 
                        onclick="window.location='/pump-shedule';"
                        style="display: flex; border-radius: 5px;
                        transition: all 0.3s;"
                        onmouseover="this.style.backgroundColor='orange'; this.style.border='1px solid green';" onmouseout="this.style.   backgroundColor='#f0f0f0'; this.style.border='1px solid transparent';"
                        class="icon-big icon-info text-center" style="width: 75px; height: 50px;justify-content: center; align-items: center; padding-bottom: 10px;justify-content: center; align-items: center ;"
                        
                        class="icon-big icon-info text-center" style="width: 75px; height: 50px; margin-right: 40px; text-align: center;">
                            <i class="fas fa-pump-soap" style="font-size: 75px; margin-bottom: 10px; color: rgb(97, 97, 226);"></i>
                        </div>
                        <div style="display: flex; justify-content:center; align-items: center; margin-left: 40px;">
                            <p style="font-size: 25px; font-weight: bold;">Pump</p>
                        </div>
                        <label class="switch" style="margin-left: auto;">
                            <input type="checkbox" id="pump-toggle" <%= pump ? 'checked' : '' %>>
                            <span class="slider round"></span>
                        </label>
                    <div>
                </div>
            </div>
        <% } else { %>
            <div class="welcome-item">
                <p class="data-value">Welcome to your IOT garden webpage, please login to see details !!!</p>
            </div>
        <% } %>
    </div>
    
    <script>
        function applyClickEffect_temp() {
            var div = document.getElementById('div-temp');
            div.style.backgroundColor = '#f0f0f0';
            div.style.border = '1px solid #ddd';
        }
        function applyClickEffect_hum() {
            var div = document.getElementById('div-hum');
            div.style.backgroundColor = '#f0f0f0';
            div.style.border = '1px solid #ddd';
        }
    </script>

    <!-- Thêm tệp Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>

    <script>
    // Cấu hình Firebase
    const firebaseConfig = {
        apiKey: "AIzaSyCOYDfXX2g7eQ2q35H1AhrCrC9s_MedTIo",
        authDomain: "tkll-project-402e9.firebaseapp.com",
        databaseURL: "https://tkll-project-402e9-default-rtdb.firebaseio.com",
        projectId: "tkll-project-402e9",
        storageBucket: "tkll-project-402e9.appspot.com",
        messagingSenderId: "440382764725",
        appId: "1:440382764725:web:36a2190a7d05f9bf8bb0fc",
        measurementId: "G-QSDYXY6YP0"
    };

    // Khởi tạo Firebase
    firebase.initializeApp(firebaseConfig);

    // Sử dụng Firebase Firestore
    var db = firebase.firestore();


    var pump_toggle = document.getElementById("pump-toggle");
    var door_toggle =  document.getElementById("door-toggle");

    pump_toggle.addEventListener("change", function() {
        var isChecked = pump_toggle.checked;
        

        // Cập nhật dữ liệu trạng thái checkbox trong Firestore
        db.collection("User").doc("data").update({
            Pump: isChecked
        });
    });

    door_toggle.addEventListener("change", function() {
        
        var isChecked = door_toggle.checked;
        // Cập nhật dữ liệu trạng thái checkbox trong Firestore
        db.collection("User").doc("data").update({
            Door: isChecked
        });
    });

    </script>
    
    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();
        socket.on('data-update', ({ temperature, humidity, door, pump, brightness }) => {
            document.getElementById("pump-toggle").checked = pump;
            document.getElementById("door-toggle").checked = door;
            document.getElementById('temperature').textContent = `${temperature}°C`;
            document.getElementById('humidity').textContent = `${humidity}%`;
            document.getElementById('brightness').textContent = `${brightness} Lux`;
        });
    </script>
<%- include('includes/end.ejs') %>